<!DOCTYPE html>
<html lang="en" ng-app="factorsApp">
<head>
    <meta charset="UTF-8">
    <title>Scene Three: Analysing Factors Contributing to Happiness Report</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
</head>
<body ng-controller="FactorsController">
    <div class="container">
        <h1>Analysing Factors Contributing to Happiness Report</h1>
        
        <div style="background: #f5f5f5; padding: 10px; margin: 10px 0; border-left: 4px solid #007bff;">
            <strong>Current Selection:</strong> 
            Year: {{selectedYear}} | 
            Country: {{selectedCountry || 'None Selected'}} | 
            Factors: {{getSelectedFactorsCount()}}
        </div>
        
        <div class="form-group select-container">
            <label for="year-select">Select Year:</label>
            <select id="year-select" ng-model="selectedYear" ng-change="updateFactors()"></select>
            <label for="country-select-scene3">Select Country:</label>
            <select id="country-select-scene3" ng-model="selectedCountry" ng-change="updateFactors()"></select>
        </div>
        
        <div class="form-group checkbox-container">
            <label><input type="checkbox" ng-model="factors.gdp" ng-change="updateFactors()"> GDP per capita</label>
            <label><input type="checkbox" ng-model="factors.social" ng-change="updateFactors()"> Social support</label>
            <label><input type="checkbox" ng-model="factors.health" ng-change="updateFactors()"> Healthy life expectancy</label>
            <label><input type="checkbox" ng-model="factors.freedom" ng-change="updateFactors()"> Freedom to make life choices</label>
            <label><input type="checkbox" ng-model="factors.generosity" ng-change="updateFactors()"> Generosity</label>
            <label><input type="checkbox" ng-model="factors.corruption" ng-change="updateFactors()"> Perceptions of corruption</label>
        </div>
        
        <div style="margin: 20px 0;">
            <button ng-click="navigateToScene('scene_one.html')" style="margin-right: 10px; padding: 8px 16px;">
                Go to Scene 1 (Map)
            </button>
            <button ng-click="navigateToScene('scene_two.html')" style="padding: 8px 16px;">
                Go to Scene 2 (Trends)
            </button>
        </div>
        
        <svg id="factors-chart"></svg>
    </div>
    
    <script src="scene_three.js"></script>
    
    <script>
        angular.module('factorsApp', [])
        .controller('FactorsController', function($scope) {
            $scope.selectedYear = '2016';
            $scope.selectedCountry = '';
            $scope.factors = {
                gdp: true,
                social: true,
                health: true,
                freedom: true,
                generosity: true,
                corruption: true
            };
            
            $scope.updateFactors = function() {
                var selectedFactors = [];
                if ($scope.factors.gdp) selectedFactors.push('GDP per capita');
                if ($scope.factors.social) selectedFactors.push('Social support');
                if ($scope.factors.health) selectedFactors.push('Healthy life expectancy');
                if ($scope.factors.freedom) selectedFactors.push('Freedom to make life choices');
                if ($scope.factors.generosity) selectedFactors.push('Generosity');
                if ($scope.factors.corruption) selectedFactors.push('Perceptions of corruption');
                
                if (window.updateFactorsChart) {
                    window.updateFactorsChart($scope.selectedYear, $scope.selectedCountry, selectedFactors);
                }
            };
            
            $scope.getSelectedFactorsCount = function() {
                var count = 0;
                for (var key in $scope.factors) {
                    if ($scope.factors[key]) count++;
                }
                return count + ' selected';
            };
            
            $scope.navigateToScene = function(scenePage) {
                window.location.href = scenePage;
            };
            
            window.angularFactorsScope = $scope;
        });
    </script>
</body>
</html>